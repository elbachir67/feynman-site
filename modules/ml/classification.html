<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Classification | IA4Ndada</title>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

    <link rel="stylesheet" href="../../styles/module.css" />
  </head>
  <body>
    <nav class="nav">
      <div class="nav-container">
        <div class="nav-breadcrumb">
          <a href="../../index.html">üè† Accueil</a>
          <span>‚Ä∫</span>
          <span>ü§ñ Machine Learning</span>
          <span>‚Ä∫</span>
          <span>Classification</span>
        </div>
        <div class="progress-indicator">
          <span id="progress-text">Progression: 0%</span>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </nav>

    <div class="container">
      <h1>üéØ Classification</h1>
      <p class="subtitle">Module 3.3 - Pr√©dire des cat√©gories</p>

      <div id="pyodide-status" class="pyodide-status">
        <span class="status-loading">‚è≥ Chargement de Python...</span>
      </div>

      <div class="objectives">
        <h2>üéØ Objectifs d'apprentissage</h2>
        <ul id="objectives-list"></ul>
      </div>

      <div id="module-content"></div>

      <div class="checkpoint">
        <h3>üéâ Checkpoint - Classification</h3>
        <p>Vous ma√Ætrisez la r√©gression logistique et la classification !</p>
        <button class="checkpoint-btn" id="checkpoint-btn" onclick="completeCheckpoint()" disabled>
          Valider le module
        </button>
      </div>

      <div class="module-nav">
        <a href="linear-regression.html" class="nav-link">‚Üê R√©gression Lin√©aire</a>
        <a href="clustering.html" class="nav-link">Clustering ‚Üí</a>
      </div>
    </div>

    <script src="../../scripts/module-engine.js"></script>
    <script>
      const moduleConfig = {
        id: "ml-classification",
        title: "Classification",
        objectives: [
          "Comprendre la diff√©rence r√©gression/classification",
          "Ma√Ætriser la fonction sigmo√Øde",
          "Construire la r√©gression logistique",
          "√âvaluer un classifieur (pr√©cision, rappel, F1)",
        ],
        content: [
          // Section 1: Le probl√®me
          {
            type: "concept",
            icon: "üí°",
            title: "Pr√©dire des cat√©gories, pas des nombres",
            content: `
              <p>La <strong>classification</strong> pr√©dit des <strong>cat√©gories discr√®tes</strong> :</p>

              <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                <tr style="background: #f0f0f0;">
                  <th style="padding: 0.5rem; border: 1px solid #ddd;">R√©gression</th>
                  <th style="padding: 0.5rem; border: 1px solid #ddd;">Classification</th>
                </tr>
                <tr>
                  <td style="padding: 0.5rem; border: 1px solid #ddd;">Prix d'une maison</td>
                  <td style="padding: 0.5rem; border: 1px solid #ddd;">Email spam ou non</td>
                </tr>
                <tr>
                  <td style="padding: 0.5rem; border: 1px solid #ddd;">Temp√©rature demain</td>
                  <td style="padding: 0.5rem; border: 1px solid #ddd;">Maladie A, B ou C</td>
                </tr>
                <tr>
                  <td style="padding: 0.5rem; border: 1px solid #ddd;">Note √† l'examen</td>
                  <td style="padding: 0.5rem; border: 1px solid #ddd;">R√©ussite ou √©chec</td>
                </tr>
              </table>

              <p><strong>Probl√®me avec la r√©gression lin√©aire :</strong></p>
              <p>Si on code spam=1 et non-spam=0, la r√©gression peut pr√©dire 1.3 ou -0.2. √áa ne veut rien dire !</p>

              <p><strong>Solution :</strong> Transformer la sortie en <strong>probabilit√©</strong> entre 0 et 1.</p>
            `,
          },
          {
            type: "quiz",
            title: "V√©rification - Type de probl√®me",
            question: "Une banque veut pr√©dire si un client va rembourser son cr√©dit ou faire d√©faut. C'est :",
            options: [
              "Un probl√®me de r√©gression",
              "Un probl√®me de classification binaire",
              "Un probl√®me de clustering",
              "Un probl√®me de recommandation",
            ],
            correctAnswer: 1,
            explanation: "Rembourser/d√©faut = 2 cat√©gories discr√®tes. C'est donc une classification binaire. La banque veut la probabilit√© de d√©faut pour d√©cider d'accorder le cr√©dit.",
          },
          // Section 2: La sigmo√Øde
          {
            type: "mathematique",
            icon: "œÉ",
            title: "La fonction sigmo√Øde",
            content: `
              <p>La sigmo√Øde transforme n'importe quel nombre en probabilit√© :</p>

              <p style="text-align: center; font-size: 1.2em; background: #e3f2fd; padding: 1rem; border-radius: 8px;">
                $$\\sigma(z) = \\frac{1}{1 + e^{-z}}$$
              </p>

              <p><strong>Propri√©t√©s cl√©s :</strong></p>
              <ul>
                <li>Si z ‚Üí -‚àû, alors œÉ(z) ‚Üí 0</li>
                <li>Si z ‚Üí +‚àû, alors œÉ(z) ‚Üí 1</li>
                <li>œÉ(0) = 0.5 (point d'√©quilibre)</li>
              </ul>

              <p><strong>Valeurs utiles √† retenir :</strong></p>
              <ul>
                <li>œÉ(-2) ‚âà 0.12 (12%)</li>
                <li>œÉ(-1) ‚âà 0.27 (27%)</li>
                <li>œÉ(0) = 0.50 (50%)</li>
                <li>œÉ(1) ‚âà 0.73 (73%)</li>
                <li>œÉ(2) ‚âà 0.88 (88%)</li>
              </ul>

              <p><strong>D√©riv√©e importante :</strong></p>
              <p style="text-align: center;">$$\\sigma'(z) = \\sigma(z) \\cdot (1 - \\sigma(z))$$</p>
            `,
          },
          {
            type: "exercise",
            title: "Calcul de sigmo√Øde",
            exerciseType: "numeric",
            content: `
              <p>Calculez œÉ(0) sachant que :</p>
              <p style="text-align: center;">$$\\sigma(0) = \\frac{1}{1 + e^{-0}} = \\frac{1}{1 + e^0} = \\frac{1}{1 + 1}$$</p>
              <p><strong>Quelle est la valeur de œÉ(0) ?</strong></p>
            `,
            correctAnswer: 0.5,
            tolerance: 0.01,
            hint: "e‚Å∞ = 1, donc œÉ(0) = 1/(1+1)",
            explanation: "œÉ(0) = 1/(1+1) = 1/2 = 0.5. C'est le point d'√©quilibre o√π la probabilit√© est 50%.",
          },
          // Section 3: R√©gression logistique
          {
            type: "concept",
            icon: "üéØ",
            title: "La r√©gression logistique",
            content: `
              <p>Le mod√®le complet en 3 √©tapes :</p>

              <p><strong>1. Combinaison lin√©aire :</strong></p>
              <p style="text-align: center;">$$z = w_1x_1 + w_2x_2 + ... + w_nx_n + b$$</p>

              <p><strong>2. Transformation en probabilit√© :</strong></p>
              <p style="text-align: center;">$$P(y=1|x) = \\sigma(z) = \\frac{1}{1 + e^{-z}}$$</p>

              <p><strong>3. D√©cision :</strong></p>
              <p style="text-align: center;">$$\\hat{y} = \\begin{cases} 1 & \\text{si } P(y=1) \\geq 0.5 \\\\ 0 & \\text{sinon} \\end{cases}$$</p>

              <p><strong>Interpr√©tation des poids :</strong></p>
              <ul>
                <li>w<sub>i</sub> > 0 : la feature augmente la probabilit√©</li>
                <li>w<sub>i</sub> < 0 : la feature diminue la probabilit√©</li>
                <li>|w<sub>i</sub>| grand : forte influence</li>
              </ul>
            `,
          },
          {
            type: "exercise",
            title: "Pr√©diction avec r√©gression logistique",
            exerciseType: "mcq",
            content: `
              <p>Un mod√®le de spam a les poids :</p>
              <ul>
                <li>w<sub>gratuit</sub> = 2.0 (pr√©sence du mot "gratuit")</li>
                <li>w<sub>urgent</sub> = 1.5 (pr√©sence du mot "urgent")</li>
                <li>b = -3.0</li>
              </ul>
              <p>Un email contient "gratuit" (x‚ÇÅ=1) mais pas "urgent" (x‚ÇÇ=0).</p>
              <p>z = 2.0√ó1 + 1.5√ó0 - 3.0 = -1.0</p>
              <p><strong>Cet email sera class√© comme :</strong></p>
            `,
            options: [
              "Spam (car z > 0)",
              "Non-spam (car œÉ(-1) ‚âà 0.27 < 0.5)",
              "Spam (car il contient 'gratuit')",
              "Impossible √† d√©terminer",
            ],
            correctAnswer: 1,
            explanation: "z = -1 ‚Üí œÉ(-1) ‚âà 0.27 < 0.5 ‚Üí class√© non-spam. Le mot 'gratuit' seul ne suffit pas √† d√©clencher l'alerte spam. Il faudrait 'gratuit' ET 'urgent' pour avoir z = 0.5 ‚Üí œÉ(0.5) ‚âà 0.62 > 0.5 ‚Üí spam.",
          },
          // Section 4: Fonction de co√ªt
          {
            type: "mathematique",
            icon: "üìâ",
            title: "La fonction de co√ªt : Binary Cross-Entropy",
            content: `
              <p><strong>Pourquoi pas MSE ?</strong></p>
              <p>Avec la sigmo√Øde, MSE n'est pas convexe ‚Üí plusieurs minimums locaux.</p>

              <p><strong>Solution : Binary Cross-Entropy (BCE)</strong></p>
              <p style="text-align: center; font-size: 1.1em; background: #e8f5e9; padding: 1rem; border-radius: 8px;">
                $$J = -\\frac{1}{n}\\sum_{i=1}^{n}[y_i\\log(\\hat{p}_i) + (1-y_i)\\log(1-\\hat{p}_i)]$$
              </p>

              <p><strong>Intuition :</strong></p>
              <ul>
                <li>Si y=1 et pÃÇ‚Üí1 : -log(1) = 0 (bon)</li>
                <li>Si y=1 et pÃÇ‚Üí0 : -log(0) = +‚àû (tr√®s mauvais)</li>
                <li>Si y=0 et pÃÇ‚Üí0 : -log(1) = 0 (bon)</li>
                <li>Si y=0 et pÃÇ‚Üí1 : -log(0) = +‚àû (tr√®s mauvais)</li>
              </ul>

              <p><strong>Avantages :</strong></p>
              <ul>
                <li>‚úÖ Convexe ‚Üí un seul minimum global</li>
                <li>‚úÖ P√©nalise fortement les erreurs confiantes</li>
                <li>‚úÖ Connexion avec le Maximum de Vraisemblance</li>
              </ul>
            `,
          },
          {
            type: "quiz",
            title: "Quiz - Cross-Entropy",
            question: "Un classifieur pr√©dit pÃÇ=0.9 pour une donn√©e qui est en r√©alit√© de classe 0 (y=0). C'est :",
            options: [
              "Une bonne pr√©diction (haute confiance)",
              "Une erreur l√©g√®re (facile √† corriger)",
              "Une erreur grave (haute confiance dans la mauvaise classe)",
              "Impossible √† √©valuer sans plus d'information",
            ],
            correctAnswer: 2,
            explanation: "Le mod√®le est tr√®s confiant (90%) mais FAUX. La cross-entropy p√©nalise fortement : -log(1-0.9) = -log(0.1) ‚âà 2.3. C'est pire qu'une erreur √† 60% qui donnerait -log(0.4) ‚âà 0.9.",
          },
          // Section 5: M√©triques
          {
            type: "concept",
            icon: "üìä",
            title: "M√©triques de classification",
            content: `
              <p><strong>Matrice de confusion :</strong></p>
              <table style="border-collapse: collapse; margin: 1rem auto; text-align: center;">
                <tr>
                  <td style="border: 1px solid #ddd;"></td>
                  <td style="border: 1px solid #ddd; background: #e3f2fd; padding: 0.5rem;"><strong>Pr√©dit +</strong></td>
                  <td style="border: 1px solid #ddd; background: #e3f2fd; padding: 0.5rem;"><strong>Pr√©dit -</strong></td>
                </tr>
                <tr>
                  <td style="border: 1px solid #ddd; background: #e3f2fd; padding: 0.5rem;"><strong>R√©el +</strong></td>
                  <td style="border: 1px solid #ddd; padding: 0.5rem; background: #c8e6c9;">VP (Vrai Positif)</td>
                  <td style="border: 1px solid #ddd; padding: 0.5rem; background: #ffcdd2;">FN (Faux N√©gatif)</td>
                </tr>
                <tr>
                  <td style="border: 1px solid #ddd; background: #e3f2fd; padding: 0.5rem;"><strong>R√©el -</strong></td>
                  <td style="border: 1px solid #ddd; padding: 0.5rem; background: #ffcdd2;">FP (Faux Positif)</td>
                  <td style="border: 1px solid #ddd; padding: 0.5rem; background: #c8e6c9;">VN (Vrai N√©gatif)</td>
                </tr>
              </table>

              <p><strong>M√©triques principales :</strong></p>
              <ul>
                <li><strong>Pr√©cision</strong> = VP / (VP + FP) ‚Äî "Parmi mes pr√©dictions +, combien sont vraies ?"</li>
                <li><strong>Rappel</strong> = VP / (VP + FN) ‚Äî "Parmi les vrais +, combien ai-je trouv√©s ?"</li>
                <li><strong>F1-Score</strong> = 2 √ó (Pr√©cision √ó Rappel) / (Pr√©cision + Rappel)</li>
                <li><strong>Accuracy</strong> = (VP + VN) / Total</li>
              </ul>
            `,
          },
          {
            type: "exercise",
            title: "Calcul de m√©triques",
            exerciseType: "numeric",
            content: `
              <p>Un d√©tecteur de fraude donne ces r√©sultats :</p>
              <ul>
                <li>VP = 80 (fraudes d√©tect√©es)</li>
                <li>FP = 20 (fausses alertes)</li>
                <li>FN = 10 (fraudes manqu√©es)</li>
                <li>VN = 890 (transactions l√©gitimes correctes)</li>
              </ul>
              <p><strong>Calculez la Pr√©cision</strong> (en d√©cimal, ex: 0.75)</p>
            `,
            correctAnswer: 0.8,
            tolerance: 0.01,
            hint: "Pr√©cision = VP / (VP + FP) = 80 / (80 + 20)",
            explanation: "Pr√©cision = 80 / 100 = 0.8 (80%). Parmi les 100 alertes de fraude, 80 √©taient de vraies fraudes.",
          },
          {
            type: "exercise",
            title: "Calcul du Rappel",
            exerciseType: "numeric",
            content: `
              <p>Avec les m√™mes donn√©es (VP=80, FN=10) :</p>
              <p><strong>Calculez le Rappel</strong> (en d√©cimal)</p>
            `,
            correctAnswer: 0.889,
            tolerance: 0.01,
            hint: "Rappel = VP / (VP + FN) = 80 / (80 + 10)",
            explanation: "Rappel = 80 / 90 ‚âà 0.889 (89%). Sur 90 vraies fraudes, on en a d√©tect√© 80.",
          },
          // Section 6: Code
          {
            type: "code",
            title: "Impl√©mentation de la r√©gression logistique",
            description: "Impl√©mentons la classification from scratch :",
            code: `import numpy as np
import matplotlib.pyplot as plt

# Fonction sigmo√Øde
def sigmoid(z):
    return 1 / (1 + np.exp(-np.clip(z, -500, 500)))

# Donn√©es : heures d'√©tude ‚Üí r√©ussite (0/1)
X = np.array([1, 2, 3, 4, 5, 6, 7, 8]).reshape(-1, 1)
y = np.array([0, 0, 0, 0, 1, 1, 1, 1])

print("üìä DONN√âES : R√âUSSITE √Ä L'EXAMEN")
print("Heures | R√©sultat")
for i in range(len(X)):
    print(f"   {X[i,0]}   | {'R√©ussite' if y[i] else '√âchec'}")

# R√©gression logistique par descente de gradient
def train_logistic(X, y, lr=0.5, epochs=1000):
    n, d = X.shape
    w = np.zeros(d)
    b = 0

    for epoch in range(epochs):
        # Pr√©diction
        z = X @ w + b
        p = sigmoid(z)

        # Gradient
        dw = (1/n) * X.T @ (p - y)
        db = (1/n) * np.sum(p - y)

        # Mise √† jour
        w -= lr * dw
        b -= lr * db

    return w, b

# Entra√Ænement
w, b = train_logistic(X, y)
print(f"\\nü§ñ MOD√àLE ENTRA√éN√â")
print(f"w = {w[0]:.3f}, b = {b:.3f}")
print(f"√âquation : z = {w[0]:.3f} √ó heures + {b:.3f}")

# Pr√©dictions
X_test = np.array([2.5, 4.5, 6.5]).reshape(-1, 1)
proba = sigmoid(X_test @ w + b)
print(f"\\nüìä PR√âDICTIONS :")
for h, p in zip(X_test.flatten(), proba):
    print(f"{h}h d'√©tude ‚Üí {p*100:.1f}% de chance de r√©ussite")

# Visualisation
plt.figure(figsize=(10, 5))
X_plot = np.linspace(0, 10, 100).reshape(-1, 1)
p_plot = sigmoid(X_plot @ w + b)

plt.scatter(X, y, c=['red' if yi==0 else 'green' for yi in y], s=100, zorder=5)
plt.plot(X_plot, p_plot, 'b-', linewidth=2, label='P(r√©ussite)')
plt.axhline(y=0.5, color='gray', linestyle='--', alpha=0.5, label='Seuil 0.5')
plt.xlabel('Heures d\\'√©tude')
plt.ylabel('Probabilit√©')
plt.title('R√©gression Logistique : Pr√©diction de R√©ussite')
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()`,
          },
          {
            type: "exercise-code",
            title: "Calculez l'accuracy d'un classifieur",
            content: `
              <p>Compl√©tez le code pour calculer l'accuracy :</p>
              <p style="text-align: center;">$$Accuracy = \\frac{VP + VN}{Total}$$</p>
            `,
            starterCode: `import numpy as np

# Pr√©dictions et vraies valeurs
y_true = np.array([1, 0, 1, 1, 0, 1, 0, 0, 1, 1])
y_pred = np.array([1, 0, 1, 0, 0, 1, 1, 0, 1, 1])

# TODO: Calculer le nombre de pr√©dictions correctes
correct = np.sum(y_true == y_pred)

# TODO: Calculer l'accuracy
total = len(y_true)
accuracy = correct / total

print(f"Pr√©dictions correctes: {correct}/{total}")
print(f"Accuracy: {accuracy:.2%}")

# Afficher la matrice de confusion
VP = np.sum((y_true == 1) & (y_pred == 1))
VN = np.sum((y_true == 0) & (y_pred == 0))
FP = np.sum((y_true == 0) & (y_pred == 1))
FN = np.sum((y_true == 1) & (y_pred == 0))

print(f"\\nMatrice de confusion:")
print(f"VP={VP}, FP={FP}")
print(f"FN={FN}, VN={VN}")`,
            solution: `import numpy as np

y_true = np.array([1, 0, 1, 1, 0, 1, 0, 0, 1, 1])
y_pred = np.array([1, 0, 1, 0, 0, 1, 1, 0, 1, 1])

correct = np.sum(y_true == y_pred)
total = len(y_true)
accuracy = correct / total

print(f"Accuracy: {accuracy:.2%}")`,
            expectedOutput: "Accuracy:",
          },
          // Section 7: Multi-classe
          {
            type: "concept",
            icon: "üî¢",
            title: "Classification multi-classe : Softmax",
            content: `
              <p><strong>Et si on a plus de 2 classes ?</strong></p>
              <p>Exemple : classifier une image en chat, chien, ou oiseau.</p>

              <p><strong>Solution : fonction Softmax</strong></p>
              <p style="text-align: center; font-size: 1.1em; background: #fff3e0; padding: 1rem; border-radius: 8px;">
                $$P(y=k) = \\frac{e^{z_k}}{\\sum_{j=1}^{K} e^{z_j}}$$
              </p>

              <p><strong>Propri√©t√©s :</strong></p>
              <ul>
                <li>Chaque sortie est entre 0 et 1</li>
                <li>La somme des probabilit√©s = 1</li>
                <li>La plus grande valeur z donne la plus grande probabilit√©</li>
              </ul>

              <p><strong>Exemple :</strong></p>
              <p>Si z = [2.0, 1.0, 0.5] pour [chat, chien, oiseau] :</p>
              <ul>
                <li>P(chat) = e¬≤/(e¬≤+e¬π+e‚Å∞¬∑‚Åµ) ‚âà 0.59</li>
                <li>P(chien) = e¬π/(e¬≤+e¬π+e‚Å∞¬∑‚Åµ) ‚âà 0.22</li>
                <li>P(oiseau) = e‚Å∞¬∑‚Åµ/(e¬≤+e¬π+e‚Å∞¬∑‚Åµ) ‚âà 0.13</li>
              </ul>
              <p>‚Üí Pr√©diction : <strong>chat</strong> (59%)</p>
            `,
          },
          {
            type: "quiz",
            title: "Quiz final - Classification",
            question: "Pour un probl√®me de d√©tection de fraude o√π les fraudes sont rares (1%), quelle m√©trique est la plus pertinente ?",
            options: [
              "Accuracy (car c'est la plus standard)",
              "Pr√©cision seule (pour √©viter les fausses alertes)",
              "Rappel seul (pour ne manquer aucune fraude)",
              "F1-Score (√©quilibre entre pr√©cision et rappel)",
            ],
            correctAnswer: 3,
            explanation: "Avec 1% de fraudes, un mod√®le qui dit toujours 'pas fraude' a 99% d'accuracy ! L'accuracy est trompeuse ici. Le F1-score √©quilibre pr√©cision (pas trop de fausses alertes) et rappel (d√©tecter un max de fraudes).",
          },
        ],
        prevModule: "linear-regression.html",
        nextModule: "clustering.html",
      };

      document.addEventListener("DOMContentLoaded", function () {
        initializeModule(moduleConfig);
      });
    </script>
  </body>
</html>
